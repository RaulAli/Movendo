<div class="profile-page" *ngIf="profile">
    <div *ngIf="currentView !== 'settings'">
        <div class="profile-header">
            <div class="profile-image">
                <img [src]="profile.image" class="user-img" />
            </div>
            <div class="profile-info">
                <div class="username-actions">
                    <h2 class="username">{{ profile.username }}</h2>
                    <button *ngIf="!isUser" class="btn" (click)="onToggleFollowing()">
                        {{ profile.following ? 'Unfollow' : 'Follow' }}
                    </button>
                    <button *ngIf="isUser" class="btn" (click)="showSettings()">
                        Edit Profile
                    </button>
                </div>
                <div class="stats">
                    <div (click)="showFollowers()" class="clickable-stat"><strong>{{ profile.followersCount }}</strong>
                        followers</div>
                    <div (click)="showFollowing()" class="clickable-stat"><strong>{{ profile.followingCount }}</strong>
                        following</div>
                </div>
            </div>
        </div>
        <div class="mid-bar">
            <div (click)="showFavorites()" class="clickable-stat" [class.selected]="currentView === 'favorites'"><strong>{{ profile.favoritesCount }}</strong>
                favorites</div>
            <div (click)="showComments()" class="clickable-stat" [class.selected]="currentView === 'comments'"><strong>{{ profile.commentsCount }}</strong>
                comments</div>
            <div *ngIf="isUser" (click)="showTickets()" class="clickable-stat" [class.selected]="currentView === 'tickets'">
                <strong>My Tickets</strong>
            </div>
        </div>
        <div class="profile-content">
            <div *ngIf="currentView === 'favorites'" class="favorites-section">
                <div class="eventos-grid">
                    <card-evento *ngFor="let evento of paginatedFavoriteEvents" [evento]="evento"
                        class="profile-card-evento"></card-evento>
                    <p *ngIf="favoriteEvents.length === 0" class="no-items-message">No favorite events to display.</p>
                </div>
                <app-pagination *ngIf="totalFavoriteEvents > itemsPerPage" [totalItems]="totalFavoriteEvents"
                    [itemsPerPage]="itemsPerPage" [currentPage]="currentFavoritePage"
                    (pageChange)="onFavoritePageChange($event)">
                </app-pagination>
            </div>

            <div *ngIf="currentView === 'comments'" class="comments-list">
                <app-comments *ngFor="let comment of paginatedComments" [comment]="comment"></app-comments>
                <p *ngIf="allComments.length === 0" class="no-items-message">No comments to display.</p>
                <app-pagination *ngIf="totalComments > itemsPerPage" [totalItems]="totalComments"
                    [itemsPerPage]="itemsPerPage" [currentPage]="currentCommentPage"
                    (pageChange)="onCommentPageChange($event)">
                </app-pagination>
            </div>

            <div *ngIf="currentView === 'tickets'" class="tickets-section">
                <div *ngIf="tickets.length > 0; else noTickets">
                    <div *ngFor="let ticket of tickets" class="ticket-card">
                        <div class="ticket-event-header">
                            <img [src]="ticket.eventId?.image?.[0] || 'https://via.placeholder.com/150x80'" alt="{{ ticket.eventId?.nombre }}">
                            <div class="ticket-event-info">
                                <h4>{{ ticket.eventId?.nombre }}</h4>
                                <p>{{ ticket.eventId?.startDate | date:'fullDate' }}</p>
                                <p>{{ ticket.eventId?.ciudad }}</p>
                            </div>
                        </div>
                        <div class="ticket-order-details">
                            <h5>Your Purchase</h5>
                            <div *ngFor="let item of ticket.orderId?.items">
                                <div class="purchased-item">
                                    <span>Event Ticket</span>
                                    <span>Quantity: {{ item.cantidad }}</span>
                                </div>
                                <div *ngFor="let m of item.populatedMerchants" class="purchased-item purchased-merchant-item">
                                    <img [src]="m.images?.[0] || 'https://via.placeholder.com/40x40'" alt="{{ m.name }}">
                                    <span>{{ m.name }}</span>
                                    <span>Quantity: {{ m.quantity }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <ng-template #noTickets>
                    <p class="no-items-message">You don't have any tickets yet.</p>
                </ng-template>
            </div>
        </div>
    </div>
    <settings-component *ngIf="currentView === 'settings'" (backToProfile)="showProfile()">
    </settings-component>

    <list-user *ngIf="showUserListModal" [users]="listUsers"
        [listType]="userListType" (closeList)="closeUserListModal()"
        (followChange)="onFollowChange()">
    </list-user>
</div>