// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Status {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model User {
  id              String   @id @map("_id") @default(uuid())
  username        String   @unique
  email           String   @unique
  password        String
  image           String?
  followersCount  Int      @default(0)
  followingCount  Int      @default(0)
  followingUsers  String[] @default([])
  favouriteEvento String[] @default([])
  refreshTokens   String[] @default([])
  isActive        Boolean  @default(true)
  status          Status   @default(PUBLISHED)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  comments        Comment[]
  eventos         Evento[] @relation("EventosDelAutor")

  @@map("users")
}

model Admin {
  id            String   @id @map("_id") @default(uuid())
  username      String   @unique
  email         String   @unique
  password      String
  image         String?
  refreshTokens String[] @default([])
  isActive      Boolean  @default(true)
  status        Status   @default(PUBLISHED)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("admin")
}

model Category {
  id          String   @id @map("_id") @default(uuid())
  nombre      String
  descripcion String?
  slug        String   @unique
  image       String?
  isActive    Boolean  @default(true)
  status      Status   @default(PUBLISHED)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  eventos     EventoCategory[]

  @@map("categories")
}

model Evento {
  id         String         @id @map("_id") @default(uuid())
  nombre     String
  ciudad     String?
  slug       String         @unique
  image      String[]
  category   String?
  price      Int?
  startDate  DateTime?
  endDate    DateTime?
  authorId   String?
  author     User?          @relation("EventosDelAutor", fields: [authorId], references: [id])
  isActive   Boolean        @default(true)
  status     Status         @default(PUBLISHED)
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  comments   Comment[]
  categories EventoCategory[]

  @@map("eventos")
}

model EventoCategory {
  id         String   @id @map("_id") @default(uuid())
  eventoId   String
  categoryId String
  evento     Evento   @relation(fields: [eventoId], references: [id])
  category   Category @relation(fields: [categoryId], references: [id])

  @@unique([eventoId, categoryId])
  @@map("eventocategory")
}

model Comment {
  id        String   @id @map("_id") @default(uuid())
  body      String
  authorId  String
  eventoId  String
  author    User     @relation(fields: [authorId], references: [id])
  evento    Evento   @relation(fields: [eventoId], references: [id])
  isActive  Boolean  @default(true)
  status    Status   @default(PUBLISHED)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("comments")
}
